From f4db0b557cdebb9e33d475439a03159a68298279 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Sun, 1 Feb 2026 19:50:29 +1100
Subject: [PATCH 7/9] Revert "don't skip gguf test if ggml is not installed
 (#14086)"

This reverts commit ed295e74dc43055bcf1f32d0de301d9b228dadfa.
---
 pyproject.toml         | 3 ++-
 test/unit/test_gguf.py | 7 +++++--
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/pyproject.toml b/pyproject.toml
index 859cdc067..944ec15a4 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -69,7 +69,7 @@ testing_minimal = [
   "hypothesis>=6.148.9",
   "z3-solver",
 ]
-testing_unit = ["tinygrad[testing_minimal]", "tqdm", "safetensors", "tabulate", "openai", "ggml-python"]
+testing_unit = ["tinygrad[testing_minimal]", "tqdm", "safetensors", "tabulate", "openai"]
 testing = [
   "tinygrad[testing_unit]",
   "pillow",
@@ -87,6 +87,7 @@ testing = [
   "networkx",
   "nibabel",
   "bottle",
+  "ggml-python",
   "capstone",
   "pycocotools",
   "boto3",
diff --git a/test/unit/test_gguf.py b/test/unit/test_gguf.py
index da9a7fe67..8e5cf1ffb 100644
--- a/test/unit/test_gguf.py
+++ b/test/unit/test_gguf.py
@@ -1,9 +1,12 @@
 import os, unittest, ctypes
 from tinygrad import dtypes, Tensor, fetch, Device
+import numpy as np
 from tinygrad.nn.state import ggml_data_to_tensor, gguf_load
 from tinygrad.device import is_dtype_supported
-import numpy as np
-import ggml
+try:
+  import ggml
+except ModuleNotFoundError:
+  raise unittest.SkipTest("ggml not installed, skipping gguf test")
 
 ggml_test_block_count = 4
 ggml_type_to_np_dtype = {
